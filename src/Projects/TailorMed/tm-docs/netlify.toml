# Netlify Configuration for TailorMed 文檔系統 (tm-docs)

[build]
  # 建置命令 - 進入 tm-docs 目錄並執行建置
  # 使用 GIT_LFS_SKIP_SMUDGE 和忽略 submodule 錯誤
  command = "cd src/Projects/TailorMed/tm-docs && npm install && npm run build"
  
  # 忽略 Git submodules（避免建置錯誤）
  ignore = "git submodule"
  
  # 發布目錄（Docusaurus 建置後的輸出目錄）
  publish = "src/Projects/TailorMed/tm-docs/build"
  
  # 建置環境變數
  [build.environment]
    # Node.js 版本（Docusaurus 需要 >= 20.0）
    NODE_VERSION = "20"
    # NPM 版本
    NPM_VERSION = "10"
    # 禁用 Git submodules 檢查（避免 submodule 錯誤）
    NETLIFY_USE_YARN = "false"
    # 跳過 Git LFS 和 submodule 處理
    GIT_LFS_SKIP_SMUDGE = "1"

# 重定向規則 - 確保所有路由都正確處理
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# 安全標頭
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    # 允許搜尋索引檔案載入
    Access-Control-Allow-Origin = "*"

# 快取設定 - 靜態資源長期快取
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/img/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/search/*"
  [headers.values]
    Cache-Control = "public, max-age=3600"

