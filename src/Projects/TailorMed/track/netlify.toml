# Netlify Configuration for TailorMed track

[build]
  # 建置命令 - 編譯 Pug 和 Stylus
  command = "node compile.js"
  
  # 發布目錄（相對於 repository root）
  publish = "dist"
  
  # Netlify Functions 目錄（相對於 repository root）
  functions = "backend/netlify/functions"

# Node.js 版本（Netlify 預設使用 Node 18）
[build.environment]
  NODE_VERSION = "18"

# Functions 打包設定
[functions]
  # 使用 esbuild 打包，確保所有依賴都被包含
  node_bundler = "esbuild"

# 環境變數（生產環境在 Netlify Dashboard 設定）
# 本地開發時從 .env 檔案讀取（backend/.env）
# Netlify dev 會自動讀取 backend/.env（如果存在）
# 生產環境必須在 Netlify Dashboard → Site settings → Environment variables 設定：
#   - AIRTABLE_API_KEY
#   - AIRTABLE_BASE_ID
#   - AIRTABLE_SHIPMENTS_TABLE

# 重定向規則
[[redirects]]
  from = "/api/tracking"
  to = "/.netlify/functions/tracking"
  status = 200

[[redirects]]
  from = "/api/tracking-public"
  to = "/.netlify/functions/tracking"
  status = 200

[[redirects]]
  from = "/api/health"
  to = "/.netlify/functions/tracking"
  status = 200

[[redirects]]
  from = "/design"
  to = "/design_ui.html"
  status = 200

[[redirects]]
  from = "/basic"
  to = "/basic.html"
  status = 200

[[redirects]]
  from = "/standard"
  to = "/standard.html"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# 安全標頭
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"

